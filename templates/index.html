<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Weightlifting Result</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
  <!-- Custom styles for this template -->
  <link href="/static/my_style.css" rel="stylesheet">

  <!--  Font-awesome-->
  <script src="https://kit.fontawesome.com/95fafbed49.js"></script>

</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <a class="navbar-brand" href="./">Restart Search</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="https://www.iwf.net/">IWF</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://www.reddit.com/r/weightlifting/">r/weightlifting
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Content -->
  <div class="container">
    <div class="intro">
      <h1 class="font-weight-heavy mt-4 text-white">Search Weightlifting Meet Result</h1>
      <div class="intro-content">
        <p class="lead text-white">Use any of the filtering options below to query weightlifting results from IWF-sanctioned meets from 1998 to present</p>
      </div>
    </div>

    <!--    query-filters-->
    <div class="query-filters">
      <form method='POST' action='/'>
        <div class="row">
          <div class="col-6">
            <div class="form-group">
              <select class="selectpicker form-control" id="name" name="name" data-size="6" data-live-search="true">
                <option class="text-muted" value="" {% if name_select=="" %} selected {% endif %}>Select Name</option>
                <option data-divider="true"></option>
                {% for name in names %}
                  <option value="{{ name }}" {% if name_select==name %} selected {% endif %}>{{ name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="col-2">
            <div class="form-group">
              <select class="selectpicker form-control" id="gender" name="gender">
                <option class="text-muted" value="" {% if gender_select=="" %} selected {% endif %}>Gender</option>
                <option data-divider="true"></option>
                <option value="m" {% if gender_select=="m" %} selected {% endif %}>Male</option>
                <option value="w" {% if gender_select=="w" %} selected {% endif %}>Female</option>
              </select>
            </div>
          </div>

          <div class="col-2">
            <div class="form-group">
              <select class="selectpicker form-control" id="nation" name="nation" data-size="6" data-live-search="true">
                <option class="text-muted" value="" {% if nation_select=="" %} selected {% endif %}>Nation</option>
                <option data-divider="true"></option>
                {% for nation in nations %}
                  <option value="{{ nation }}" {% if nation_select==nation %} selected {% endif %}>{{ nation }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="col-2">
            <div class="form-group">
              <select class="selectpicker form-control" id="weight_class" name="weight_class">
                <option class="text-muted" value="" {% if weight_class_select=="" %} selected {% endif %}>Weight Class</option>
                <option data-divider="true"></option>
                {% for weight_class in weight_classes %}
                  <option value="{{ weight_class }}" {% if weight_class_select==weight_class %} selected {% endif %}>{{ weight_class }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>
        <!--        first row-->

        <div class="row">
          <div class="col-6">
            <div class="form-group">
              <select class="selectpicker form-control" id="meet" name="meet" data-size="6" data-live-search="true">
                <option class="text-muted" value="" {% if meet_select=="" %} selected {% endif %}>Select Meet</option>
                <option data-divider="true"></option>
                {% for meet in meets %}
                  <option value="{{ meet }}" {% if meet_select==meet %} selected {% endif %}>{{ meet }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="col-2">
            <button type="submit" class="btn btn-primary btn-block"><i class="fas fa-search"></i></button>
          </div>
        </div>
      </form>
    </div>
    <!-- /.query-filters -->

    <div class="query-result">
      {% if results[0] == "No result found." %}
        <h4>{{ results[0] }} </h4>
      {% else %}
        {% for result in results %}
          <h4>{{ result.name, result.nation, result.weight_class, result.gender }}</h4>
        {% endfor %}
      {% endif %}
    </div>
  </div>
  <!-- /.page-content -->

  <!-- Footer -->
  <footer class="footer bg-dark text-white-50">
    <div class="container">
      <p class="m-0 text-center text-white">Copyright &copy; Fanchen Bao 2019</p>
    </div>
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
  <script type="text/javascript">
    // manually set bootstrap version for bootstrap-select
    $.fn.selectpicker.Constructor.BootstrapVersion = "4.3.1";

    // Learned from here https://flask.palletsprojects.com/en/1.0.x/patterns/jquery/
    $(function() {
      $('#gender').change(function() {
        $.getJSON(
          '/weight_class',                // backend url to call
          {gender: $('#gender').val()},   // data to be passed to the backend url
          function(data) {                // after backend returns processed data back, handle new data
            // Remove old options
            $('#weight_class').empty()
            // Add new items for option
            $('#weight_class').append('<option class="text-muted" value="" {% if weight_class_select=="" %} selected {% endif %}>Weight Class</option><option data-divider="true"></option>')
            $.each(data, function(i, val){
              $('#weight_class').append('<option value="' + val + '">' + val + '</option>');
            });
            $('#weight_class').selectpicker('refresh');  // important step to allow for dynamic update of select options
          }
        );
      });
    });
  </script>
</body>

</html>